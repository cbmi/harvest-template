define(["underscore","backbone","../core","../constants","../structs","./paginator"],function(t,e,i,r,n,s){var a=n.Frame.extend({idAttribute:"page",url:function(){var e=t.result(this.collection,"url");return i.utils.alterUrlParams(e,{page:this.id,per_page:this.collection.perPage})}}),o=n.FrameArray.extend({currentPageNum:1,limit:20,numPages:void 0,initialize:function(){t.bindAll(this,"fetch","markAsDirty","onWorkspaceUnload","onWorkspaceLoad","refresh"),this.isDirty=!0,this.isWorkspaceOpen=!1,this._refresh=t.debounce(this.refresh,r.CLICK_DELAY),i.on(i.VIEW_SYNCED,this.markAsDirty),i.on(i.CONTEXT_SYNCED,this.markAsDirty),this.on("workspace:load",this.onWorkspaceLoad),this.on("workspace:unload",this.onWorkspaceUnload)},onWorkspaceLoad:function(){this.isWorkspaceOpen=!0,this._refresh()},onWorkspaceUnload:function(){this.isWorkspaceOpen=!1},markAsDirty:function(){this.isDirty=!0,this._refresh()},cancel:function(){return this.pending&&(this.pending.abort&&this.pending.abort(),delete this.pending),e.ajax({type:"delete",url:t.result(this,"url"),contentType:"application/json"})},fetch:function(t){t||(t={});var e;if((e=i.config.get("session.defaults.data.preview"))&&(t.type="POST",t.contentType="application/json",t.data=JSON.stringify(e)),this.isDirty&&this.isWorkspaceOpen)return this.isDirty=!1,void 0===t.cache&&(t.cache=!1),n.FrameArray.prototype.fetch.call(this,t);var r=this;return{done:function(){return delete r.pending}}},url:function(){return i.utils.alterUrlParams(t.result(this,"_url"),{page:this.currentPageNum,limit:this.limit})},setResultCount:function(t){this.numPages=void 0!==t?Math.ceil(t/this.limit):void 0,this.trigger("change:pagecount",this,this.numPages)}});return t.extend(o.prototype,s.PaginatorMixin),o.prototype.setCurrentPage=function(t){if(t!==this.currentPageNum){if(this.numPages&&!this.hasPage(t))throw new Error("Cannot set the current page out of bounds");return this.previousPageNum=this.currentPageNum,this.currentPageNum=t,this.trigger.apply(this,["change:currentpage",this].concat([].slice.call(this.getCurrentPageStats())))}},o.prototype.parse=function(t,e){return e.reset||this.reset(null,{silent:!0}),t?(this.currentPageNum=null,this.setCurrentPage(t.page),[t]):void 0},o.prototype.getCurrentPageStats=function(){return[this.currentPageNum,{previous:this.previousPageNum,first:1===this.currentPageNum,next:this.currentPageNum===this.numPages,last:this.currentPageNum===this.numPages||void 0===this.numPages}]},o.prototype.getPage=function(t,e){if(e||(e={}),void 0===this.numPages||this.hasPage(t)){var r=this.get(t);if(!r&&e.load!==!1){r=new this.model({page:t}),r.pending=!0,this.add(r);var n,s={};(n=i.config.get("session.defaults.data.preview"))&&(s.type="POST",s.contentType="application/json",s.data=JSON.stringify(n)),r.fetch(s).done(function(){delete r.pending})}return r&&e.active!==!1&&this.setCurrentPage(t),r}},o.prototype.model=a,{Results:o}});
//# sourceMappingURL=results.js.map
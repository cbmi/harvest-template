define(["underscore","backbone","marionette","jquery","loglevel","./core","./ui","./csrf"],function(e,t,n,o,i,r,a,c){function u(e){e=e||window.event;var t;t=e.type in m?m[e.type]:!this[g],t===!0?r.trigger("visible"):t===!1&&r.trigger("hidden")}r.templates.set(r.config.get("templates",{})),r.controls.set(r.config.get("controls",{}));var s=n.TemplateCache.prototype.loadTemplate,l=n.TemplateCache.prototype.compileTemplate;n.TemplateCache.prototype.loadTemplate=function(e){var t=r.templates.get(e);return t||(t=s.call(this,e)),t},n.TemplateCache.prototype.compileTemplate=function(e){return"function"!=typeof e&&(e=l(e)),e},e.exists=function(t){return!e.isUndefined(t)&&!e.isNull(t)};var d=new a.Notifications({id:"cilantro-notifications"});o("body").append(d.render().el),r.notify=d.notify,o.ajaxPrefilter(function(e){e.xhrFields={withCredentials:!0}});var f=r.config.get("csrf");f&&f.token&&c.apply(f.header,f.token),r.config.get("debug")&&(i.setLevel("debug"),r.on("all",function(){i.info.apply(i.info,[].slice.call(arguments,0))})),o(window).on("beforeunload",function(){return r.config.get("debug")||!o.hasPendingRequest()?void o(document).off("ajaxError"):"Wow, you're quick! Your data is being saved. It will only take a moment."}),o(document).ajaxError(function(e,t,n,o){if(!("abort"===t.statusText||t.status>=300&&t.status<400)){var i="";i=0===t.status&&""===o?"The application is no longer responding.":'There is a communication problem with the server. <a href="#" onclick="location.reload()">Refreshing</a> the page may help.',r.notify({timeout:null,dismissable:!0,level:"error",header:"Uh oh.",message:i})}}),o(document).on("click","a",function(e){if(r.router){var n=this.pathname;"/"!==n.charAt(0)&&(n="/"+n);var o=t.history.root||"/";n.slice(0,o.length)===o&&(n=n.slice(o.length)),r.router.hasRoute(n)&&(e.preventDefault(),r.router.navigate(n,{trigger:!0}))}}),o(document).on("click","[data-route]",function(e){if(r.router){var t=o(e.target).attr("data-route");r.router.isNavigable(t)&&(e.preventDefault(),r.router.navigate(t,{trigger:!0}))}});var g="hidden",m={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};g in document?document.addEventListener("visibilitychange",u):(g="mozHidden")in document?document.addEventListener("mozvisibilitychange",u):(g="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",u):(g="msHidden")in document?document.addEventListener("msvisibilitychange",u):"onfocusin"in document?document.onfocusin=document.onfocusout=u:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=u,window.onblur=function(){r.trigger("blur")},window.onfocus=function(){r.trigger("focus")}});
//# sourceMappingURL=setup.js.map